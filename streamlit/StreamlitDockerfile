# /********************************************************************************************************************
# *  Copyright 2024 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *
# *                                                                                                                    *
# *  Licensed under the Amazon Software License (the "License"). You may not use this file except in compliance        *
# *  with the License. A copy of the License is located at                                                             *
# *                                                                                                                    *
# *      http://aws.amazon.com/asl/                                                                                    *
# *                                                                                                                    *
# *  or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES *
# *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions    *
# *  and limitations under the License.                                                                                *
# **********************************************************************************************************************/

FROM ubuntu:focal

# Install primary dependencies.
RUN apt-get update 
RUN apt-get upgrade -y
RUN apt-get install git curl python3 python3-pip python3-venv -y

# Install nodejs.
RUN curl -sL https://deb.nodesource.com/setup_20.x | bash
RUN apt-get install nodejs

# Clean cache.
RUN rm -rf /var/lib/apt/lists/*

# Install node and python packages.
RUN npm install -g create-react-app
RUN pip install langchain langchain-community 
RUN pip install streamlit boto3 
# RUN pip install duckduckgo-search 
RUN pip install git-remote-codecommit
 

# Copy the app.
COPY . /app
WORKDIR /app

# Setup streamlit.
EXPOSE 8501

CMD ["streamlit", "run", "streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]

# BEDROCK_REGION=us-west-2 BEDROCK_MODEL_ID="anthropic.claude-3-sonnet-20240229-v1:0" streamlit run streamlit_app.py
# CMD ["BEDROCK_REGION=us-west-2", "BEDROCK_MODEL_ID='anthropic.claude-3-sonnet-20240229-v1:0'", "streamlit", "run", "streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]

# docker run  --env-file .env  -v /Users/anuragvs/Documents/work/aiml/ai-developer-prototype-eks-os/cdk/eks/workspace:/home/ubuntu/workspace -p 8501:8501 test